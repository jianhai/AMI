postinstall scriptlet (using /bin/sh):
# Upgrade- remove old symlink
if [ "$1" = "2" ]; then
    rm -f /opt/aws/apitools/cfn-init
    # also remove old init script if it exists
    if [ -e  /etc/rc.d/init.d/cfn-hup ]; then
        rm -f  /etc/rc.d/init.d/cfn-hup
    fi
fi

# Install/Upgrade - Create symlink from versioned
# directory to product name directory if it doesn't exist
if [ ! -e  /opt/aws/apitools/cfn-init ]; then
    ln -s  ./cfn-init-1.4-11.6.amzn1  /opt/aws/apitools/cfn-init
fi

# Create aws bin directory if it doesn't exist:
if [ ! -d /opt/aws/bin ]; then
    mkdir /opt/aws/bin
fi

for command in /opt/aws/apitools/cfn-init/bin/*; do
        if [ -e /opt/aws/bin/$(basename $command) ]; then
        if [ "$1" = "2" ]; then
            # Upgrade- remove old symlinks
            rm -f /opt/aws/bin/$(basename $command)
        fi
    fi
    if [ ! -h /opt/aws/bin/$(basename $command) ]; then
    # Install relative symlink from generic directory to aws shared directory
        ln -s ../apitools/cfn-init/bin/$(basename $command)  /opt/aws/bin/$(basename $command)
    fi
done

# Create link to init script
if [ ! -e /etc/rc.d/init.d/cfn-hup ]; then
    ln -s /opt/aws/apitools/cfn-init/init/redhat/cfn-hup  /etc/rc.d/init.d/cfn-hup
fi

chmod 755 /etc/rc.d/init.d/cfn-hup
chmod 755 /opt/aws/apitools/cfn-init/init/redhat/cfn-hup
preuninstall scriptlet (using /bin/sh):
# Uninstall: 
if [ "$1" = "0" ]; then
    #Clean up the symlinks if it points to this version
    if [ "x$(readlink /opt/aws/apitools/cfn-init)" == "x./cfn-init-1.4-11.6.amzn1" ]; then
        for command in /opt/aws/bin/cfn*; do
            if [ "x$(readlink $command)" == "x../apitools/cfn-init/bin/$(basename $command)" ]; then
                rm -f $command
            fi
        done
    fi
fi
postuninstall scriptlet (using /bin/sh):
if [ "$1" = "0" ]; then
    if [ ! "$(ls -A /opt/aws/bin)" ]; then
        rmdir /opt/aws/bin
    fi

    rm -f /opt/aws/apitools/cfn-init

    if [ ! "$(ls -A /opt/aws/apitools)" ]; then
        rmdir /opt/aws/apitools
    fi

    if [ ! "$(ls -A /opt/aws)" ]; then
        rmdir /opt/aws
    fi
fi
