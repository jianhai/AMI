From 425d0eb0f8e9c31030c20851a5c9efd0524a87e9 Mon Sep 17 00:00:00 2001
From: Cristian Gafton <gafton@amazon.com>
Date: Wed, 16 Oct 2013 05:36:45 +0000
Subject: ixgbevf: switch default to dynamic interrupt throttling

Signed-off-by: Cristian Gafton <gafton@amazon.com>
(cherry picked from commit 11f50afddcdb909598013de98ea55c74e85d0363)
Signed-off-by: Munehisa Kamata <kamatam@amazon.com>
---
 drivers/amazon/ixgbevf/ixgbevf_param.c | 22 +++++++++++++++-------
 1 file changed, 15 insertions(+), 7 deletions(-)

diff --git a/drivers/amazon/ixgbevf/ixgbevf_param.c b/drivers/amazon/ixgbevf/ixgbevf_param.c
index 78a0813..d59425d 100644
--- a/drivers/amazon/ixgbevf/ixgbevf_param.c
+++ b/drivers/amazon/ixgbevf/ixgbevf_param.c
@@ -73,9 +73,9 @@
  *
  * Valid Range: 956-488281 (0=off, 1=dynamic)
  *
- * Default Value: 8000
+ * Default Value: 1 (changed from the hardcoded 8000 in upstream driver)
  */
-#define DEFAULT_ITR                 8000
+#define DEFAULT_ITR                 1
 IXGBE_PARAM(InterruptThrottleRate, "Maximum interrupts per second, per vector, (956-488281), default 8000, use 1 for dynamic");
 #define MAX_ITR       IXGBE_MAX_INT_RATE
 #define MIN_ITR       IXGBE_MIN_INT_RATE
@@ -205,11 +205,19 @@ void __devinit ixgbevf_check_options(struct ixgbevf_adapter *adapter)
 				break;
 			}
 #ifdef module_param_array
-		} else if (opt.def < 2) {
-			adapter->rx_itr_setting = opt.def;
-		} else {
-			adapter->rx_itr_setting = (1000000/opt.def) << 2;
-		}
+		} else switch (opt.def) {
+			case 0:
+				DPRINTK(PROBE, INFO, "%s turned off\n", opt.name);
+				adapter->rx_itr_setting = 0;
+				break;
+			case 1:
+				DPRINTK(PROBE, INFO, "%s is dynamic\n", opt.name);
+				adapter->rx_itr_setting = 1;
+				break;
+			default:
+                                adapter->rx_itr_setting = (1000000/opt.def) << 2;
+                                break;
+                }
 #endif
 		adapter->tx_itr_setting = adapter->rx_itr_setting;
 	}
-- 
2.7.4

